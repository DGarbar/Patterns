# Посетитель

![UML](/src/AdditionalDocs/uml/Visitor.png)

Позволяет **создавать новые операции, не меняя классы объектов, над которыми эти операции могут выполняться**.

[***Проблема раннего и позднего связывания**][BindingTypes]

## Применимость

 - Когда вам нужно выполнить операцию над всеми элементами сложной структуры объектов (например, деревом).

   - **Посетитель** позволяет применять одну и ту же операцию к объектам различных классов.

 - Когда над объектами сложной структуры объектов надо выполнять некоторые, **не связанные между собой операций, но вы не хотите «засорять» классы такими операциями**.

   - **Посетитель** позволяет извлечь родственные операции из классов, составляющих структуру объектов, поместив их в один класс-посетитель. **Если структура объектов является общей для нескольких приложений, то паттерн позволит в каждое приложение включить только нужные операции**.

 - Когда **новое поведение имеет смысл только для некоторых классов из существующей иерархии**.

   - **Посетитель** позволяет определить поведение только для этих классов и оставить его пустым для всех остальных.

## Шаги реализации
 
1. Создайте **интерфейс посетителя и объявите в нём методы «посещения» для каждого класса компонента, который существует в программе**.

2. **Опишите интерфейс компонентов**. Если вы работаете с уже существующими классами, то объявите абстрактный метод принятия посетителей в базовом классе иерархии компонентов.

3. Реализуйте **методы принятия во всех конкретных компонентах**. Они должны **переадресовывать вызовы тому методу посетителя, в котором класс параметра совпадает с текущим классом компонента**.

4. Иерархия компонентов должна знать только о **базовом интерфейсе посетителей**. С другой стороны, **посетители будут знать обо всех классах компонентов**.

5. Для **каждого нового поведения создайте свой конкретный класс**. Приспособьте это поведение для всех посещаемых компонентов, **реализовав все методы интерфейса посетителей**.

   Вы можете столкнуться с ситуацией, **когда посетителю нужен будет доступ к приватным полям компонентов**. **В этом случае, вы можете либо раскрыть доступ к этим полям, нарушив инкапсуляцию компонентов, либо сделать класс посетителя вложенным в класс компонента**, если вам повезло писать на языке, который поддерживает вложенность классов.

6. Клиент будет создавать объекты посетителей, а затем передавать их компонентам, используя метод принятия.

## Преимущества и недостатки
 
 | + | - |
 | ------ | ------ |
 |Упрощает **добавление новых операций над всей связанной структурой объектов**.|Паттерн **неоправдан, если иерархия компонентов часто меняется**.
 |Объединяет родственные операции в одном классе. |Может привести к нарушению инкапсуляции компонентов.
 |Посетитель **может накоплять состояние при обходе структуры компонентов**.
 
## Отношения с другими паттернами

- **Посетитель** можно рассматривать как расширенный аналог [**Команды**][Command], который способен работать сразу с несколькими видами получателей.

- Вы можете выполнить какое-то действие над всем деревом [**Компоновщика**][Composite] при помощи **Посетителя**.

- **Посетитель** можно использовать совместно с [**Итератором**][Iterator]. [**Итератор**][Iterator] будет отвечать за обход структуры данных, а **Посетитель** - за выполнение действий над каждым её компонентом.

[BindingTypes]: </src/AdditionalDocs/BindingTypes/>

[Abstract_Factory]: </src/Creational/Factorys/Abstract_Factory/Abstract_Factory.md>
[Factory_Method]: </src/Creational/Factorys/Factory_Method/Factory_Method.md>
[Builder]: </src/Creational/Builder/Builder.md>
[Prototype]: </src/Creational/Prototype/Prototype.md>
[Singleton]: </src/Creational/Singleton/Singleton.md>

[Adapter]: </src/Structural/Adapter/Adapter.md>
[Bridge]: </src/Structural/Bridge/Bridge.md>
[Composite]: </src/Structural/Composite/Composite.md>
[Decorator]: </src/Structural/Decorator/Decorator.md>
[Facade]: </src/Structural/Facade/Facade.md>
[Flyweight]: </src/Structural/Flyweight/Flyweight.md>
[Proxy]: </src/Structural/Proxy/Proxy.md>

[Chain_of_Responsibility]: </src/Behavioral/Chain_of_Responsibility/Chain_of_Responsibility.md>
[Command]: </src/Behavioral/Command/Command.md>
[Iterator]: </src/Behavioral/Iterator/Iterator.md>
[Mediator]: </src/Behavioral/Mediator/Mediator.md>
[Memento]: </src/Behavioral/Memento/Memento.md>
[Observer]: </src/Behavioral/Observer/Observer.md>
[State]: </src/Behavioral/State/State.md>
[Strategy]: </src/Behavioral/Strategy/Strategy.md>
[Template_Method]: </src/Behavioral/Template_Method/Template_Method.md>
[Visitor]: </src/Behavioral/Visitor/Visitor.md>