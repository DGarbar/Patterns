# Хранитель

![UML](/src/AdditionalDocs/uml/Memento/Memento.png)

Классическая реализация паттерна полагается на **механизм вложенных классов**. (Java)

Когда нужно полностью исключить доступ к состоянию Создателей и Снимков.
![UML](/src/AdditionalDocs/uml/Memento/MementoSave.png)

Позволяет не нарушая инкапсуляцию, зафиксировать и сохранить внутреннее состояние объекта так, чтобы позднее восстановить его в это состояние.

## Применимость
 
 (Serialization = Memento)
 
 - Когда вам нужно **сохранять мгновенный снимок состояния объекта (или его части)**, чтобы впоследствии объект можно было восстановить в том же состоянии.

    - **Снимок позволяет делать любое количество снимков объекта и хранить их независимо от объекта**, с которого делают снимок. Снимки часто используют не только для реализации операции отмены, но и для транзакций, когда состояние объекта нужно откатить, если операция не удалась.

 - Когда **прямое получение состояния объекта раскрывает детали его реализации и нарушает инкапсуляцию**.

    - Паттерн предлагает изготовить снимок самому исходному объекту, так как ему доступны все поля, даже приватные.

## Шаги реализации

1. Определите класс создателя, объекты которого должны создавать снимки своего состояния.

2. Создайте **класс снимка и опишите в нём все те же поля, которые имеются в оригинальном классе-создателе**.

3. Сделайте **объекты снимков неизменяемыми**. Они должны получать начальные значения только один раз, через свой конструктор.

4. Если ваш язык программирования это позволяет, сделайте **класс снимка вложенным в класс создателя**.

   Если нет, извлеките из класса снимка пустой интерфейс, который будет доступен остальным объектам программы. Впоследствии вы можете добавить некоторые вспомогательные методы в этот интерфейс, дающие доступ к метаданным снимка, однако прямой доступ к данным создателя должен быть исключён.

5. Добавьте в **класс создателя метод получения снимков**. Создатель должен создавать новые объекты снимков, передавая значения своих полей через конструктор.

   Сигнатура метода должна возвращать снимки через ограниченный интерфейс, если он у вас есть. Сам класс должен работать с конкретным классом снимка.

6. Добавьте в **класс создателя метод восстановления из снимка**. Что касается привязки к типам, руководствуйтесь той же логикой, что и в пункте 4.

7. Опекуны, будь то история операций, объекты команд или нечто иное, должны знать о том, когда запрашивать снимки у создателя, где их хранить, и когда восстанавливать.

8. **Связь опекунов с создателями можно перенести внутрь снимков**. В этом случае каждый снимок будет привязан к своему создателю и должен будет сам восстанавливать его состояние. Но **это будет работать либо если классы снимков вложены в классы создателей, либо если создатели имеют сеттеры для установки значений своих полей**.

## Преимущества и недостатки

 | + | - |
 | ------ | ------ |
 |Не нарушает инкапсуляции исходного объекта.|Требует **много памяти, если клиенты слишком часто создают снимки**.
 |Упрощает структуру исходного объекта. Ему **не нужно хранить историю версий своего состояния**.|Может **повлечь дополнительные издержки памяти, если объекты, хранящие историю, не освобождают ресурсы**, занятые устаревшими снимками.
 | |В некоторых языках (например, PHP, Python, JavaScript) сложно гарантировать, чтобы только исходный объект имел доступ к состоянию снимка.

## Отношения с другими паттернами

- [**Команду**][Command] и **Снимок** можно использовать сообща для реализации отмены операций. В этом случе объекты команд будут отображать выполненные действие над объектом, снимки - хранить копию состояния этого объекта до того, как команда была выполнена.

- **Снимок** можно использовать вместе с [**Итератором**][Iterator], чтобы сохранить текущее состояние обхода структуры данных и вернуться к нему в будущем, если потребуется.

- **Снимок** иногда можно заменить [**Прототипом**][Prototype], если объект, чьё состояние требуется сохранять в истории, довольно простой, не имеет активных ссылок на внешние ресурсы, либо их можно легко восстановить.

[Abstract_Factory]: </src/Creational/Factorys/Abstract_Factory/Abstract_Factory.md>
[Factory_Method]: </src/Creational/Factorys/Factory_Method/Factory_Method.md>
[Builder]: </src/Creational/Builder/Builder.md>
[Prototype]: </src/Creational/Prototype/Prоtotype.md>
[Singleton]: </src/Creational/Singleton/Singleton.md>

[Adapter]: </src/Structural/Adapter/Adapter.md>
[Bridge]: </src/Structural/Bridge/Bridge.md>
[Composite]: </src/Structural/Composite/Composite.md>
[Decorator]: </src/Structural/Decorator/Decorator.md>
[Facade]: </src/Structural/Facade/Facade.md>
[Flyweight]: </src/Structural/Flyweight/Flyweight.md>
[Proxy]: </src/Structural/Proxy/Proxy.md>

[Chain_of_Responsibility]: </src/Behavioral/Chain_of_Responsibility/Chain_of_Responsibility.md>
[Command]: </src/Behavioral/Command/Command.md>
[Iterator]: </src/Behavioral/Iterator/Iterator.md>
[Mediator]: </src/Behavioral/Mediator/Mediator.md>
[Memento]: </src/Behavioral/Memento/Memento.md>
[Observer]: </src/Behavioral/Observer/Observer.md>
[State]: </src/Behavioral/State/State.md>
[Strategy]: </src/Behavioral/Strategy/Strategy.md>
[Template_Method]: </src/Behavioral/Template_Method/Template_Method.md>
[Visitor]: </src/Behavioral/Visitor/Visitor.md>
